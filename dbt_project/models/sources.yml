version: 2

sources:
  - name: youtube_raw
    description: |
      Raw JSON data from YouTube Data API v3 stored in BigQuery.
      Data is synced by Python crawler (extract/crawlers.py).
      
      **Sync frequency:** Configured per channel in channels.yml (default: daily)
      **Data format:** JSON/STRUCT columns containing full API responses
      **Storage:** BigQuery dataset specified by BQ_DATASET_ID env var
    
    database: "{{ env_var('GCP_PROJECT_ID') }}"
    schema: "{{ env_var('BQ_DATASET_ID', 'raw_yt') }}"
    
    tables:
      - name: raw_videos
        description: |
          Raw video data from YouTube Data API v3 videos.list() endpoint.
          Each row contains full JSON response in 'raw' column.
        
        columns:
          - name: id
            description: Video ID (Primary Key)
            tests:
              - unique
              - not_null
          
          - name: raw
            description: |
              JSON string containing full API response with:
              - snippet: title, description, tags, publishedAt, categoryId
              - statistics: viewCount, likeCount, commentCount
              - contentDetails: duration (ISO 8601), caption, definition
              - status: privacyStatus, embeddable, madeForKids
          
          - name: ingestion_time
            description: Timestamp when data was crawled
            tests:
              - not_null

      - name: raw_channels
        description: |
          Raw channel data from YouTube Data API v3 channels.list() endpoint.
        
        columns:
          - name: id
            description: Channel ID (Primary Key)
            tests:
              - unique
              - not_null
          
          - name: raw
            description: |
              JSON string containing:
              - snippet: title, publishedAt, country
              - statistics: subscriberCount, viewCount, videoCount
              - contentDetails.relatedPlaylists.uploads: Uploads playlist ID
              - topicDetails.topicIds: Topic categorization
          
          - name: ingestion_time
            description: Timestamp when data was crawled
            tests:
              - not_null

      - name: raw_playlists
        description: |
          Raw playlist data from YouTube Data API v3 playlists.list() endpoint.
        
        columns:
          - name: id
            description: Playlist ID (Primary Key)
            tests:
              - unique
              - not_null
          
          - name: channel_id
            description: Channel ID that owns the playlist
            tests:
              - not_null
          
          - name: raw
            description: |
              JSON string containing:
              - snippet: title, publishedAt
              - contentDetails.itemCount: Number of videos
              - status.privacyStatus: public/private/unlisted
          
          - name: ingestion_time
            description: Timestamp when data was crawled
            tests:
              - not_null

      - name: raw_comments
        description: |
          Raw comments data from YouTube Data API v3 commentThreads.list() endpoint.
          Only present if include_comments=true in channels.yml
        
        columns:
          - name: id
            description: Comment thread ID (Primary Key)
            tests:
              - unique
              - not_null
          
          - name: video_id
            description: Video ID the comment belongs to
            tests:
              - not_null
          
          - name: channel_id
            description: Channel ID (for filtering)
            tests:
              - not_null
          
          - name: raw
            description: |
              JSON string containing:
              - snippet.topLevelComment.snippet: authorDisplayName, textDisplay, likeCount, publishedAt
              - snippet.totalReplyCount: Number of replies
          
          - name: ingestion_time
            description: Timestamp when data was crawled
            tests:
              - not_null
